<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í˜ëŸ¿ ì–´ë“œë²¤ì²˜ ëª¨ë°”ì¼</title>
    <style>
        /* í„°ì¹˜ ì‹œ ë“œë˜ê·¸ë‚˜ í™•ëŒ€ ë°©ì§€ */
        * { touch-action: manipulation; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; overflow: hidden; background: #333; font-family: 'Arial', sans-serif; }
        canvas { display: block; margin: 0 auto; background: #a5f3fc; cursor: pointer; border-bottom: 10px solid #4ade80; }
        #ui { position: absolute; top: 10px; left: 10px; color: #2d3436; font-weight: bold; pointer-events: none; z-index: 10; }
        #restartBtn { 
            position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%);
            padding: 15px 30px; font-size: 20px; cursor: pointer; display: none;
            background: #ff7675; border: none; border-radius: 15px; color: white;
            box-shadow: 0 6px #d63031; z-index: 20;
        }
    </style>
</head>
<body>
    <div id="ui">
        <h1 style="margin:0; font-size: 24px;">Score: <span id="score">0</span></h1>
        <p style="font-size: 14px; margin: 5px 0;">í™”ë©´ í„°ì¹˜: ì í”„ | ğŸ: ì ìˆ˜ | â­: ë¬´ì </p>
    </div>
    <button id="restartBtn">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const restartBtn = document.getElementById('restartBtn');

// í™”ë©´ í¬ê¸°ì— ë§ê²Œ ì¡°ì ˆ
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = Math.min(window.innerHeight, 500);
}
window.addEventListener('resize', resize);
resize();

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playNote(freq, type, duration, vol = 0.1) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(vol, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

let score = 0;
let isGameOver = false;
let frame = 0;
let gameSpeed = 6; // ëª¨ë°”ì¼ ë°°ë ¤ë¥¼ ìœ„í•´ ì‹œì‘ ì†ë„ ì†Œí­ í•˜í–¥
let invince = 0;

let ferret = {
    x: 50, y: 350, w: 80, h: 40, // í¬ê¸° ì‚´ì§ ì¡°ì •
    dy: 0, gravity: 0.7, jump: 13,
    jCount: 0
};

let objects = [];

function drawFerret(f) {
    ctx.save();
    ctx.translate(f.x, f.y);
    if (invince > 0 && frame % 10 < 5) ctx.globalAlpha = 0.3;

    // ìºë¦­í„° ê·¸ë¦¬ê¸° (í”½ì…€ ìŠ¤íƒ€ì¼ ìœ ì§€)
    ctx.fillStyle = "#8d6e63"; ctx.fillRect(-10, 15, 20, 12); // ê¼¬ë¦¬
    ctx.fillStyle = "#ede0d4"; ctx.fillRect(0, 8, 65, 32);   // ëª¸í†µ
    ctx.fillStyle = "#5d4037"; ctx.fillRect(10, 38, 12, 8); ctx.fillRect(45, 38, 12, 8); // ë‹¤ë¦¬
    ctx.fillStyle = "#5d4037"; ctx.fillRect(50, 12, 30, 16); // ì–¼êµ´ë¬´ëŠ¬
    ctx.fillStyle = "#ede0d4"; ctx.fillRect(55, 4, 25, 10); ctx.fillStyle = "#5d4037";
    ctx.fillRect(60, 0, 8, 8); ctx.fillRect(72, 0, 8, 8);   // ë¨¸ë¦¬ & ê·€
    ctx.fillStyle = "white"; ctx.fillRect(62, 16, 6, 6); ctx.fillRect(74, 16, 6, 6); // ëˆˆ
    ctx.fillStyle = "black"; ctx.fillRect(64, 18, 3, 3); ctx.fillRect(76, 18, 3, 3);
    ctx.fillStyle = "#ffccbc"; ctx.fillRect(77, 26, 6, 5); // ì½”
    ctx.restore();
}

function resetGame() {
    score = 0; isGameOver = false; frame = 0; gameSpeed = 6;
    invince = 0; ferret.y = canvas.height - 100; ferret.dy = 0;
    objects = [];
    scoreEl.innerText = score;
    restartBtn.style.display = 'none';
    loop();
}

function update() {
    if (isGameOver) return;
    ferret.dy += ferret.gravity;
    ferret.y += ferret.dy;
    const floor = canvas.height - 50 - ferret.h;
    if (ferret.y > floor) { ferret.y = floor; ferret.dy = 0; ferret.jCount = 0; }
    if (invince > 0) invince--;

    if (frame % 90 === 0) {
        let r = Math.random();
        if (r < 0.7) objects.push({x: canvas.width, y: canvas.height - 90, w: 35, h: 40, type: 'obs', color: '#e17055'});
        else if (r < 0.9) objects.push({x: canvas.width, y: canvas.height - 200, w: 30, h: 30, type: 'apple'});
        else objects.push({x: canvas.width, y: canvas.height - 250, w: 35, h: 35, type: 'star'});
    }

    objects.forEach((obj, i) => {
        obj.x -= gameSpeed;
        if (ferret.x < obj.x + obj.w && ferret.x + ferret.w > obj.x &&
            ferret.y < obj.y + obj.h && ferret.y + ferret.h > obj.y) {
            if (obj.type === 'obs') {
                if (invince > 0) { objects.splice(i, 1); score += 10; playNote(600, 'square', 0.1); }
                else gameOver();
            } else if (obj.type === 'apple') { objects.splice(i, 1); score += 50; playNote(800, 'sine', 0.2); }
            else if (obj.type === 'star') { objects.splice(i, 1); invince = 400; playNote(1200, 'sine', 0.4); }
        }
        if (obj.x + obj.w < 0) objects.splice(i, 1);
    });

    if (frame % 10 === 0) score++;
    scoreEl.innerText = score;
    gameSpeed += 0.001;
    frame++;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    objects.forEach(obj => {
        if (obj.type === 'obs') { ctx.fillStyle = obj.color; ctx.fillRect(obj.x, obj.y, obj.w, obj.h); }
        else if (obj.type === 'apple') { ctx.fillStyle = "#ff7675"; ctx.beginPath(); ctx.arc(obj.x+15, obj.y+15, 15, 0, Math.PI*2); ctx.fill(); }
        else if (obj.type === 'star') { ctx.font = "24px Arial"; ctx.fillText("â­", obj.x, obj.y + 20); }
    });
    drawFerret(ferret);
    if (isGameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.6)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.font = "bold 30px Arial";
        ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
    }
}

function gameOver() { isGameOver = true; restartBtn.style.display = 'block'; playNote(150, 'sawtooth', 0.5, 0.2); }

function loop() { if (!isGameOver) { update(); draw(); requestAnimationFrame(loop); } }

// --- ì…ë ¥ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼/PC í†µí•©) ---
function handleAction(e) {
    if (e) e.preventDefault();
    if (isGameOver) return;
    if (!started) { started = true; loop(); return; }
    if (ferret.jCount < 2) {
        ferret.dy = -ferret.jump;
        ferret.jCount++;
        playNote(400 + ferret.jCount * 150, 'sine', 0.1);
    }
}

let started = false;
window.addEventListener('keydown', (e) => { if(e.code === 'Space') handleAction(); });
canvas.addEventListener('touchstart', handleAction, {passive: false});
restartBtn.addEventListener('click', (e) => { e.stopPropagation(); resetGame(); });

// ì´ˆê¸° í™”ë©´
ctx.fillStyle = "#2d3436"; ctx.font = "20px Arial"; ctx.textAlign = "center";
ctx.fillText("í™”ë©´ì„ í„°ì¹˜í•´ì„œ ì‹œì‘í•˜ì„¸ìš”!", canvas.width/2, canvas.height/2);
</script>
</body>
</html>
